## 시나리오 정리

1. 호스트가 방을 만든다. (닉네임, 메뉴 필요)

2. 게스트가 초대코드로 방을 들어간다. (닉네임, 메뉴 필요)
    - 닉네임 입력시 중복 여부 체크
    - 방에 인원이 추가될때 마다 룰렛의 확률이 1/N로 조정된다.
    - 최대 인원은 9명이다.

3. 참가자 탭을 클릭하면 참가자들의 정보가 표시된다. (메뉴, 이름, 인원 수)

4. 미니게임 탭을 클릭하면 미니게임 종류가 표시된다.
    - 호스트가 미니게임을 선택한다. (최소 1개, 최대 5개)
    
5. 룰렛 탭을 클릭하면 각 사용자별 확률에 맞게 룰렛이 표시된다.

6. 호스트가 게임시작 버튼을 클릭하면 미니게임이 진행된다.
    - 한 번한 미니게임은 다시 할 수 없다.
   
7. 미니게임이 종료되면 해당 미니게임의 결과를 표시한다.
   - 미니게임 결과를 통해 룰렛의 확률이 조정된다.

8. 룰렛 현황 보러가기를 클릭하면, 룰렛의 현황을 표시한다.
   - 더 플레이할 미니게임이 남아있다면, 시작할 수 있다.
   - 만약 플레이할 미니게임이 없다면, 룰렛을 돌릴 수 있다. 
   
9. 룰렛의 당첨자를 계산한다.

10. 룰렛의 결과가 화면에 표시된다.(당첨자, 주문 리스트)

## 플레이어 (Player)   
### 상태
- `name`: `String` 플레이어 이름
- `menu`: `Menu` 메뉴 

### 행위
- `selectMenu(menu)`: 메뉴를 선택

### 규칙
- 하나의 방에서 이름은 중복될 수 없다.
- 메뉴는 필수이다.

## 방 (Room)             
### 상태
- `id`: `Long` 방 id
- `joinCode`: `JoinCode` 초대 코드
- `host`: `Player` 방의 호스트
- `players`: `Players` 플레이어 관리 객체
- `roulette`: `Roulette` 룰렛
- `miniGames`: `List<MiniGame>` 방에서 플레이할 미니게임들
- `roomState`: `RoomState` 방의 상태 (준비, 플레이, 종료)

### 행위
- `joinPlayer(Player player)`: 플레이어가 참가한다.
- `leavePlayer(Player player)`: 플레이어가 방을 나간다.
- `setMiniGame(List<MiniGame> miniGames)`: 미니게임을 설정한다.
- `startRoulette()`: 룰렛을 돌린다.
- `applyMiniGameResult(MiniGameResult)`: 미니게임 결과를 반영한다.
- `isHost(Player)`: 해당 플레이어가 호스트인지 확인한다.

### 규칙
- `roomState`가 `READY`일 때만 사용자가 들어올 수 있다.
- 미니게임은 5개 이하여야 한다.
- 플레이어가 2인 이상이어야 게임을 시작할 수 있다.
- 플레이어는 최대 9명 접속할 수 있다.
- 플레이어들끼리 이름은 같을 수가 없다.

## 플레이어들 (Players)
> 플레이어 컬렉션을 관리하는 일급 컬렉션
### 상태
- `playerInfos`: `PlayerInfos` 플레이어와 확률 정보를 관리하는 객체

### 행위
- `join(Player)`: 플레이어를 추가한다.
- `hasEnoughPlayers()`: 게임 시작에 충분한 플레이어가 있는지 확인한다.
- `getPlayers()`: 모든 플레이어 목록을 가져온다.
- `getPlayer(String playerName)`: 이름으로 플레이어를 조회한다.

### 규칙
- 최소 2명, 최대 9명의 플레이어를 관리한다.
- PlayerInfos에 모든 플레이어 관련 작업을 위임한다.

## 룰렛 (Roulette)
### 상태
- `playerInfos`: `PlayerInfos` 플레이어별 룰렛 당첨 확률
- `randomGenerator`: `RandomGenerator` 난수 생성기

### 행위
- `adjustProbabilities(MiniGameResult, int round)`: 미니게임 결과에 따라 플레이어의 당첨 확률 조정
- `spin()`: 룰렛을 돌린다. (`Player`를 반환한다.) 

### 규칙
- 모든 플레이어의 확률의 합은 1이어야 한다.
- spin을 하면 플레이어별 확률에 기반해서 winner를 랜덤하게 선정한다.

## 플레이어 정보들 (PlayerInfos)
### 상태
- `adjustedProbabilities`: `Map<Player, Probability>` 플레이어와 확률 매핑 (유일한 데이터 소스)

### 행위
- `join(Player)`: 새로운 플레이어를 추가하고 모든 플레이어의 확률을 재설정한다.
- `adjustProbabilities(MiniGameResult, ProbabilityCalculator)`: 미니게임 결과에 따라 확률을 조정한다.
- `getProbability(Player)`: 특정 플레이어의 확률을 가져온다.
- `getPlayers()`: 모든 플레이어 목록을 Map에서 변환하여 가져온다.
- `getPlayer(String playerName)`: 이름으로 플레이어를 조회한다.
- `getPlayerCount()`: 현재 참여 중인 플레이어 수를 반환한다.

### 규칙
- Map이 유일한 데이터 소스 역할을 하여 데이터 일관성을 보장한다.
- 플레이어 추가/제거 시 모든 플레이어의 확률을 1/N로 재계산한다.
- List<Player>가 필요한 경우 Map의 keySet에서 변환하여 제공한다.
- 최대 9명까지 플레이어를 관리할 수 있다.
- 중복된 플레이어 이름은 허용하지 않는다.

## 확률 (Probability)
### 상태
- `value`: `Integer` 확률 값 (0 ~ 10000 사이의 정수)

### 행위
- `plus(Probability)`: 확률을 더한다.
- `minus(Probability)`: 확률을 뺀다.
- `divide(int)`: 확률을 나눈다.
- `multiple(int)`: 확률을 곱한다.
- `adjust(MiniGameResultType, Probability)`: 미니게임 결과 타입에 따라 확률을 조정한다.

### 규칙
- `value`는 0에서 10000 사이의 값을 가진다. (확률의 소수점 두 자리를 정수로 표현)

## 확률 계산기 (ProbabilityCalculator)
### 상태
- `playerCount`: `int` 플레이어 수
- `round`: `int` 현재 라운드

### 행위
- `computeInitialProbability(int playerCount)`: 초기 확률을 계산한다. (정적 메서드)
- `calculateAdjustProbability(int playerCount, int rank)`: 순위에 따른 확률 조정값을 계산한다.

### 규칙
- 초기 확률은 1/N (모든 플레이어 동일)
- 미니게임 결과에 따라 확률 조정값이 달라진다.

## 방 상태(Room State)
_Enum_
### 상수
- `READY`: 준비 중 (플레이어 참여 가능)
- `PLAYING`: 게임 중 (플레이어 변경 불가)
- `DONE`: 종료

## 초대코드 (JoinCode)       
### 상태
- `value`: `String` 초대 코드 값

### 행위
- `generate()` 랜덤 초대 코드를 생성한다.

### 규칙
- 초대 코드는 6자리 랜덤 문자열이다.
- 0, 1, I, O 는 포함하지 않는다.

## 메뉴 (Menu)
### 상태
- `id`: `Long` 메뉴 id
- `name`: `String` 메뉴 이름
- `image`: `String` 메뉴 이미지

### 행위

### 규칙
- 메뉴의 이름은 중복될 수 없다.
- 메뉴 이미지는 uri여야 한다.(uri 규칙 추종)
- 메뉴 이름은 필수
- 이미지는 필수(null이라면 기본 이미지)

## 미니게임 (MiniGame)      
_Enum_
> 미니게임을 나타내는 Enum. 실제 게임 로직은 `Playable` 인터페이스와 구현체에 있다.
### 상수
- `CARD_GAME`: 카드 게임
- `ROULETTE_GAME`: 룰렛 게임 (구현 예정)

# 카드 게임 도메인

## 카드 게임 (CardGame)
> `Playable` 인터페이스의 구현체. 두 라운드에 걸쳐 카드를 선택하고 점수를 계산한다.

### 상태
- `cardGameRounds`: `List<CardGameRound>` 카드 게임 라운드들
- `deckGenerator`: `CardGameDeckGenerator` 카드 덱 생성 전략

### 행위
- `play(List<Player>)`: 카드 게임을 실행한다.
- `chooseCard(Player, Card)`: 플레이어가 카드를 선택한다.
- `calculateScores()`: 최종 점수를 계산한다.

## 카드 게임 라운드 (CardGameRound)
### 상태
- `roundNumber`: `int` 라운드 번호
- `playerChoices`: `Map<Player, Card>` 플레이어의 카드 선택

### 행위
- `choose(Player, Card)`: 플레이어가 카드를 선택한다.
- `isFinished(int totalPlayers)`: 모든 플레이어가 카드를 선택했는지 확인한다.

## 카드 (Card)
_Interface_
> 게임에 사용되는 카드를 나타내는 인터페이스

### 행위
- `calculate(CardGameScore)`: 현재 점수에 카드의 효과를 적용한다.

## 덧셈 카드 (AdditionCard)
> `Card` 인터페이스의 구현체. 점수를 더하거나 뺀다.
### 상태
- `value`: `int` 더할 점수

## 곱셈 카드 (MultiplierCard)
> `Card` 인터페이스의 구현체. 점수를 곱한다.
### 상태
- `value`: `double` 곱할 값

## 카드 게임 점수 (CardGameScore)
### 상태
- `value`: `int` 점수 합

### 행위
- `add(int)`: 점수를 더한다.
- `multiply(double)`: 점수를 곱한다.

### 규칙
- 처음 값은 0이다.

## 카드 덱 생성기 (CardGameDeckGenerator)
_Interface_
> 카드 게임에 사용될 덱을 생성하는 전략 인터페이스

### 행위
- `generate()`: `List<Card>`를 생성하여 반환한다.

## 랜덤 카드 덱 생성기 (CardGameRandomDeckGenerator)
> `CardGameDeckGenerator`의 구현체. 정해진 규칙에 따라 랜덤하게 카드를 생성한다.

## 미니게임 플레이 서비스 (MiniGamePlayService)
> 미니게임을 실제로 실행하고 결과를 반환하는 서비스
### 상태
- `playable`: `Playable` 실행할 미니게임 로직

### 행위
- `play(List<Player>)`: 게임을 실행하고 결과를 반환한다.

## 플레이 가능한 게임 (Playable)      
_Interface_
> 미니게임 로직을 정의하는 인터페이스
### 행위
- `play(List<Player>)`: 게임을 실행한다. (`MiniGameResult` 반환)

## 미니게임 결과 (MiniGameResult)  
### 상태
- `resultType`: `MiniGameResultType` 결과 타입 (승/패, 순위 등)
- `winners`: `List<Player>` 승자 목록
- `losers`: `List<Player>` 패자 목록
- `ranks`: `List<Player>` 순위 목록

### 행위
- `getPlayerRank(Player)`: 특정 플레이어의 순위를 반환한다.

## 미니게임 결과 타입 (MiniGameResultType)
_Enum_
> 미니게임 결과에 따른 확률 조정 방향을 나타내는 Enum

### 상수
- `WIN`: 승리 (확률 감소)
- `LOSE`: 패배 (확률 증가)
- `DRAW`: 무승부 (확률 유지)

### 행위
- `of(int playerCount, int rank)`: 플레이어 수와 순위로 결과 타입을 결정한다. (정적 메서드)
