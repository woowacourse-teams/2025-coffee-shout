## 시나리오 정리

1. 호스트가 방을 만든다. (닉네임, 메뉴 필요)

2. 게스트가 초대코드로 방을 들어간다. (닉네임, 메뉴 필요)
    - 닉네임 입력시 중복 여부 체크
    - 방에 인원이 추가될때 마다 룰렛의 확률이 1/N로 조정된다.
    - 최대 인원은 9명이다.

3. 참가자 탭을 클릭하면 참가자들의 정보가 표시된다. (메뉴, 이름, 인원 수)

4. 미니게임 탭을 클릭하면 미니게임 종류가 표시된다.
    - 호스트가 미니게임을 선택한다. (최소 1개, 최대 5개)

5. 룰렛 탭을 클릭하면 각 사용자별 확률에 맞게 룰렛이 표시된다.

6. 호스트가 게임시작 버튼을 클릭하면 미니게임이 진행된다.
    - 한 번한 미니게임은 다시 할 수 없다.

7. 미니게임이 종료되면 해당 미니게임의 결과를 표시한다.
    - 미니게임 결과를 통해 룰렛의 확률이 조정된다.

8. 룰렛 현황 보러가기를 클릭하면, 룰렛의 현황을 표시한다.
    - 더 플레이할 미니게임이 남아있다면, 시작할 수 있다.
    - 만약 플레이할 미니게임이 없다면, 룰렛을 돌릴 수 있다.

9. 룰렛의 당첨자를 계산한다.

10. 룰렛의 결과가 화면에 표시된다.(당첨자, 주문 리스트)

## 플레이어 이름 (PlayerName)

### 상태

- `value`: `String` 플레이어 이름

### 규칙

- 이름은 공백일 수 없다.
- 이름은 10자 이하여야 한다.

## 플레이어 (Player)

### 상태

- `name`: `PlayerName` 플레이어 이름
- `playerType`: `PlayerType` 플레이어 타입 (호스트, 게스트)
- `menu`: `Menu` 메뉴
- `isReady`: `Boolean` 준비 상태
- `colorIndex`: `Integer` 플레이어 색상 인덱스

### 행위

- `createHost(PlayerName, Menu)`: 호스트 플레이어를 생성한다.
- `createGuest(PlayerName, Menu)`: 게스트 플레이어를 생성한다.
- `selectMenu(menu)`: 메뉴를 선택한다.
- `sameName(PlayerName)`: 같은 이름인지 확인한다.
- `assignColorIndex(int)`: 컬러 인덱스를 할당한다.
- `updateReadyState(Boolean)`: 준비 상태를 업데이트한다.

### 규칙

- 하나의 방에서 이름은 중복될 수 없다.
- 메뉴는 필수이다.

## 플레이어들 (Players)

### 상태

- `players`: `List<Player>` 플레이어 목록
- `colorUsage`: `ColorUsage` 사용된 색상 관리

### 행위

- `join(Player)`: 플레이어를 방에 추가한다.
- `hasEnoughPlayers(int, int)`: 최소/최대 인원 범위에 맞는지 확인한다.
- `getPlayer(PlayerName)`: 특정 이름의 플레이어를 찾는다.
- `getPlayerCount()`: 플레이어 수를 반환한다.
- `hasDuplicateName(PlayerName)`: 플레이어 이름이 중복되는지 확인한다.
- `isAllReady()`: 모든 플레이어가 준비되었는지 확인한다.
- `removePlayer(PlayerName)`: 플레이어를 제거한다.
- `existsByName(PlayerName)`: 해당 이름의 플레이어가 존재하는지 확인한다.

## 방 (Room)

### 상태

- `joinCode`: `JoinCode` 초대 코드
- `host`: `Player` 방장
- `players`: `Players` 방에 참여한 플레이어들
- `roulette`: `Roulette` 룰렛
- `miniGames`: `Queue<Playable>` 진행할 미니게임 목록
- `finishedGames`: `List<Playable>` 완료된 미니게임 목록
- `roomState`: `RoomState` 방의 상태 (준비, 플레이, 종료)

### 행위

- `createNewRoom(JoinCode, PlayerName, Menu)`: 새로운 방을 생성한다.
- `joinGuest(PlayerName, Menu)`: 게스트가 방에 참가한다.
- `addMiniGame(PlayerName, Playable)`: 미니게임을 추가한다.
- `removeMiniGame(PlayerName, Playable)`: 미니게임을 제거한다.
- `applyMiniGameResult(MiniGameResult)`: 미니게임 결과를 룰렛에 적용한다.
- `isPlayingState()`: 게임 진행 상태인지 확인한다.
- `spinRoulette(Player)`: 룰렛을 돌린다.
- `isHost(Player)`: 해당 플레이어가 호스트인지 확인한다.
- `getPlayers()`: 모든 플레이어 목록을 반환한다.
- `findPlayer(PlayerName)`: 플레이어를 찾는다.
- `getProbabilities()`: 모든 플레이어의 확률을 가져온다.
- `getAllMiniGame()`: 모든 미니게임 목록을 가져온다.
- `getSelectedMiniGameTypes()`: 선택된 미니게임 타입 목록을 가져온다.
- `findMiniGame(MiniGameType)`: 특정 타입의 미니게임을 찾는다.
- `startNextGame(String)`: 다음 미니게임을 시작한다.
- `clearMiniGames()`: 모든 미니게임을 초기화한다.
- `hasDuplicatePlayerName(PlayerName)`: 중복된 플레이어 이름이 있는지 확인한다.
- `removePlayer(PlayerName)`: 플레이어를 제거한다.
- `reJoin(PlayerName, Menu)`: 플레이어가 재입장한다.

### 규칙

- `roomState`가 `READY`일 때만 사용자가 들어오고, 메뉴 선택이 가능하다.
- 미니게임은 5개 이하여야 한다.
- 플레이어가 2인 이상이어야 게임을 시작할 수 있다.
- 플레이어는 최대 9명 접속할 수 있다.
- 플레이어들끼리 이름은 같을 수가 없다.
- 호스트만 미니게임을 추가/제거/시작할 수 있다.

## 룰렛 (Roulette)

### 상태

- `randomPicker`: `RandomPicker` 랜덤 선택기
- `playerProbabilities`: `Map<Player, Probability>` 플레이어별 룰렛 당첨 확률

### 행위

- `spin()`: 룰렛을 돌려서 당첨자를 선택한다. (`Winner`를 반환한다.)
- `join(Player)`: 새로운 플레이어를 추가하고 확률을 재분배한다.
- `adjustProbabilities(MiniGameResult, ProbabilityCalculator)`: 미니게임 결과에 따라 플레이어의 당첨 확률 조정
- `getProbability(Player)`: 특정 플레이어의 확률을 가져온다.
- `getProbabilities()`: 모든 플레이어의 확률을 가져온다.
- `removePlayer(PlayerName)`: 플레이어를 제거하고 확률을 재조정한다.

### 규칙

- 모든 플레이어의 확률의 합은 1이어야 한다.
- spin을 하면 플레이어별 확률에 기반해서 winner를 랜덤하게 선정한다.

## 확률 (Probability)

### 상태

- `value`: `Integer` 확률 값 (0 ~ 10000 사이의 정수)

### 행위

- `plus(Probability)`: 확률을 더한다.
- `minus(Probability)`: 확률을 뺀다.
- `divide(int)`: 확률을 나눈다.
- `multiple(int)`: 확률을 곱한다.
- `getProbabilityChange(MiniGameResultType)`: 미니게임 결과 타입에 따라 확률 변화량을 가져온다.

### 규칙

- `value`는 0에서 10000 사이의 값을 가진다. (확률의 소수점 두 자리를 정수로 표현)

## 확률 계산기 (ProbabilityCalculator)

### 행위

- `calculateProbabilityChange(int, int)`: 등수와 동점자 수를 기반으로 조정할 확률을 계산한다.

## 룰렛 범위들 (RouletteRanges)

### 상태

- `ranges`: `List<RouletteRange>` 플레이어별 확률을 기반으로 한 범위 정보

### 행위

- `pickPlayer(int)`: 주어진 숫자에 해당하는 플레이어를 선택한다.
- `endValue()`: 전체 범위의 끝 값을 반환한다.

## 랜덤 선택기 (RandomPicker)

_Interface_

### 행위

- `nextInt(int, int)`: 주어진 범위에서 랜덤 정수를 생성한다.

## 방 상태(RoomState)

_Enum_

### 상수

- `READY`: 준비 중
- `PLAYING`: 게임 중
- `DONE`: 종료

## 초대코드 (JoinCode)

### 상태

- `value`: `String` 초대 코드 값
- `qrCodeUrl` : `String` QR 코드 URL

### 행위

- `generate()` 랜덤 초대 코드를 생성한다.

### 규칙

- 초대 코드는 5자리 랜덤 문자열이다.
- 0, 1, I, O 는 포함하지 않는다.

## 메뉴 카테고리 (MenuCategory)

### 상태

- `id`: `Long` 메뉴 카테고리 ID
- `name`: `String` 메뉴 카테고리 이름
- `imageUrl`: `String` 메뉴 카테고리 이미지 URL

### 행위

- `getId()`: 메뉴 카테고리 ID를 반환한다.
- `getName()`: 메뉴 카테고리 이름을 반환한다.
- `getImageUrl()`: 메뉴 카테고리 이미지 URL을 반환한다.
- `setId(Long)`: 메뉴 카테고리 ID를 설정한다.

## 메뉴 (Menu)

### 상태

- `id`: `Long` 메뉴 id
- `name`: `String` 메뉴 이름
- `menuCategory`: `MenuCategory` 메뉴 카테고리

### 행위

- `setId(long)`: 메뉴 ID를 설정한다.

## 미니게임 타입 (MiniGameType)

_Enum_

### 상수

- `CARD_GAME`: 카드 게임

### 행위

- `createMiniGame()`: 미니게임 객체를 생성한다.

## 플레이 가능한 게임 (Playable)

_Interface_

### 행위

- `getResult()`: 게임 결과를 반환한다. (`MiniGameResult` 반환)
- `getScores()`: 플레이어별 점수를 반환한다.
- `getMiniGameType()`: 미니게임 타입을 반환한다.
- `startGame(List<Player>)`: 게임을 시작한다.

## 미니게임 결과 (MiniGameResult)

### 상태

- `rank`: `Map<Player, Integer>` 플레이어별 순위

### 행위

- `getPlayerRank(Player)`: 특정 플레이어의 순위를 가져온다.
- `from(Map<Player, MiniGameScore>)`: 점수 맵으로부터 결과를 생성한다.
- `getTieCountByRank(int)`: 특정 등수의 동점자 수를 반환한다.

## 미니게임 결과 타입 (MiniGameResultType)

_Enum_

### 상수

- `WINNER`: 승자
- `LOSER`: 패자
- `UNDECIDED`: 무승부

### 행위

- `of(int, int)`: 전체 플레이어 수와 순위를 기반으로 결과 타입을 반환한다.
- `adjustProbability(int, int, Probability)`: 확률을 조정한다.
