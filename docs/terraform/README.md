# ì»¤í”¼ë¹µ Terraform ì¸í”„ë¼ êµ¬ì„±

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [ìš”êµ¬ì‚¬í•­](#ìš”êµ¬ì‚¬í•­)
4. [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#ë””ë ‰í† ë¦¬-êµ¬ì¡°)
5. [ì‹œì‘í•˜ê¸°](#ì‹œì‘í•˜ê¸°)

---

## ê°œìš”

ì»¤í”¼ë¹µ í”„ë¡œì íŠ¸ì˜ AWS ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Terraform êµ¬ì„±ì…ë‹ˆë‹¤.

**ëª©í‘œ**:
- Infrastructure as Code (IaC)ë¥¼ í†µí•œ ì¸í”„ë¼ ë²„ì „ ê´€ë¦¬
- í™˜ê²½ë³„ (DEV/PROD) ì¼ê´€ëœ ì¸í”„ë¼ êµ¬ì„±
- íŒ€ì› ê°„ ì¸í”„ë¼ êµ¬ì„± ê³µìœ  ë° í˜‘ì—…

**ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ**:
- Terraform >= 1.0
- AWS Provider ~> 5.0
- AWS ì„œìš¸ ë¦¬ì „ (ap-northeast-2)

---

## ì•„í‚¤í…ì²˜ ì„¤ê³„

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VPC (Single)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Public Subnets                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚  â”‚  â”‚  DEV EC2     â”‚  â”‚     ALB      â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚  (Backend)   â”‚  â”‚              â”‚                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Private Subnets                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  PROD EC2    â”‚  â”‚     RDS      â”‚  â”‚ElastiCacheâ”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (Backend)   â”‚  â”‚  MySQL 8.0   â”‚  â”‚  (Valkey) â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µ êµ¬ì¡°

1. **Network Layer**: VPC, Subnets, Route Tables, Internet Gateway, NAT Gateway
2. **Security Layer**: Security Groups (ê³„ì¸µë³„ ë¶„ë¦¬)
3. **Data Layer**: RDS (MySQL), ElastiCache (Valkey)
4. **Compute Layer**: EC2 Instances (DEV/PROD), ALB
5. **CI/CD Layer**: CodePipeline, CodeBuild, CodeDeploy

---

## ìš”êµ¬ì‚¬í•­

### ğŸŒ ê³µí†µ ì‚¬í•­

- **VPC**: í•˜ë‚˜ì˜ VPCì—ì„œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- **ì„œë¸Œë„·**: ì„œë¹„ìŠ¤ ê°„ ë¶„ë¦¬í•˜ë˜, ì„œë¸Œë„· ê°„ í†µì‹  ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±
- **í™˜ê²½ ë¶„ë¦¬**: EC2 ì¸ìŠ¤í„´ìŠ¤ë§Œ DEV/PROD ë¶„ë¦¬, ë‚˜ë¨¸ì§€ ë¦¬ì†ŒìŠ¤ëŠ” ê³µìœ 
- **CodePipeline**: ë¸Œëœì¹˜ë³„ë¡œ 2ê°œ (DEVìš©, PRODìš©)

### ğŸ”’ ë³´ì•ˆ ê·¸ë£¹

- í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ì„œë§Œ í¬íŠ¸ ì˜¤í”ˆ
- EC2: 80(HTTP), 443(HTTPS) í¬íŠ¸ ì˜¤í”ˆ
- ê³„ì¸µë³„ ë³´ì•ˆ ê·¸ë£¹ ë¶„ë¦¬:
  - ALB Security Group
  - EC2 Security Group (Backend)
  - RDS Security Group
  - ElastiCache Security Group

### ğŸ–¥ï¸ ë°±ì—”ë“œ ì¸í”„ë¼

#### EC2 ì¸ìŠ¤í„´ìŠ¤
- **ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: T4G-small (ARM ê¸°ë°˜)
- **OS**: Ubuntu 24.04 LTS
- **í™˜ê²½ êµ¬ë¶„**:
  - **DEV**: Public Subnet (ì™¸ë¶€ ì ‘ê·¼ ê°€ëŠ¥, ëª¨ë‹ˆí„°ë§ íˆ´ ì—°ê³„)
  - **PROD**: Private Subnet (ALBë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼)
- **ìŠ¤í† ë¦¬ì§€**: ê° ì¸ìŠ¤í„´ìŠ¤ë‹¹ EBS 15GB

#### Application Load Balancer (ALB)
- Public Subnetì— ë°°ì¹˜
- EC2 ì¸ìŠ¤í„´ìŠ¤ë“¤ì— íŠ¸ë˜í”½ ë¶„ì‚°
- CodeDeployì™€ ì—°ê³„í•˜ì—¬ Blue/Green ë°°í¬ ì§€ì›

#### RDS (MySQL)
- **ë²„ì „**: MySQL 8.0.43
- **ì¸ìŠ¤í„´ìŠ¤ í´ë˜ìŠ¤**: í”„ë¦¬í‹°ì–´ ë ˆë²¨ (db.t3.micro ë˜ëŠ” db.t4g.micro)
- **ë°°ì¹˜**: Private Subnet
- **Multi-AZ**: ìš´ì˜ í™˜ê²½ ê³ ë ¤ ì‹œ í™œì„±í™”
- **ë°±ì—…**: ìë™ ë°±ì—… í™œì„±í™”

#### ElastiCache
- **ì—”ì§„**: Valkey (Redis í˜¸í™˜)
- **ë…¸ë“œ íƒ€ì…**: í”„ë¦¬í‹°ì–´ ë˜ëŠ” ì†Œí˜• ì¸ìŠ¤í„´ìŠ¤
- **ë°°ì¹˜**: Private Subnet

#### CI/CD Pipeline
- **CodePipeline**: ë¸Œëœì¹˜ë³„ íŒŒì´í”„ë¼ì¸ (dev, main)
- **CodeBuild**: ë¹Œë“œ ìë™í™”
- **CodeDeploy**: ALB ì—°ê³„ ë°°í¬
- **ë°°í¬ ì „ëµ**: Blue/Green Deployment

### ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ ì¸í”„ë¼

- **CloudFront**: ì œê±° (ì™¸ë¶€ CDN ì‚¬ìš©)
- **CI/CD**: GitHub Actions í™œìš©
- **í˜¸ìŠ¤íŒ…**: ì™¸ë¶€ CDN ì„œë¹„ìŠ¤ í™œìš©

---

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
terraform/
â”œâ”€â”€ main.tf                    # ë©”ì¸ Terraform ì„¤ì •
â”œâ”€â”€ variables.tf               # ì „ì—­ ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf                 # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ provider.tf                # AWS Provider ì„¤ì •
â”œâ”€â”€ backend.tf                 # Terraform State ë°±ì—”ë“œ ì„¤ì •
â”‚
â”œâ”€â”€ environments/              # í™˜ê²½ë³„ ë³€ìˆ˜ íŒŒì¼
â”‚   â”œâ”€â”€ dev.tfvars
â”‚   â””â”€â”€ prod.tfvars
â”‚
â””â”€â”€ modules/                   # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆë“¤
    â”œâ”€â”€ network/              # VPC, Subnet, Route Table
    â”œâ”€â”€ security-groups/      # ë³´ì•ˆ ê·¸ë£¹ ì •ì˜
    â”œâ”€â”€ ec2/                  # EC2 ì¸ìŠ¤í„´ìŠ¤
    â”œâ”€â”€ alb/                  # Application Load Balancer
    â”œâ”€â”€ rds/                  # RDS MySQL
    â”œâ”€â”€ elasticache/          # ElastiCache Valkey
    â””â”€â”€ codepipeline/         # CI/CD íŒŒì´í”„ë¼ì¸
```

---

## ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

1. **Terraform ì„¤ì¹˜**
   ```bash
   # macOS
   brew install terraform

   # Linux
   wget https://releases.hashicorp.com/terraform/1.9.8/terraform_1.9.8_linux_amd64.zip
   unzip terraform_1.9.8_linux_amd64.zip
   sudo mv terraform /usr/local/bin/
   ```

2. **AWS CLI ì„¤ì •**
   ```bash
   aws configure
   # AWS Access Key ID: [ì…ë ¥]
   # AWS Secret Access Key: [ì…ë ¥]
   # Default region: ap-northeast-2
   # Default output format: json
   ```

3. **í•„ìš”í•œ ê¶Œí•œ**
   - EC2, VPC, RDS, ElastiCache, ALB, CodePipeline ê´€ë ¨ IAM ê¶Œí•œ

### ì´ˆê¸° ì„¤ì •

```bash
cd terraform

# Terraform ì´ˆê¸°í™”
terraform init

# ê°œë°œ í™˜ê²½ ì ìš© ê³„íš í™•ì¸
terraform plan -var-file=environments/dev.tfvars

# ê°œë°œ í™˜ê²½ ì¸í”„ë¼ ìƒì„±
terraform apply -var-file=environments/dev.tfvars
```

### ì£¼ìš” ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `terraform init` | Terraform ì´ˆê¸°í™” ë° í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ |
| `terraform plan` | ë³€ê²½ì‚¬í•­ ë¯¸ë¦¬ë³´ê¸° |
| `terraform apply` | ì¸í”„ë¼ ìƒì„±/ë³€ê²½ ì ìš© |
| `terraform destroy` | ì¸í”„ë¼ ì‚­ì œ |
| `terraform fmt` | ì½”ë“œ í¬ë§·íŒ… |
| `terraform validate` | êµ¬ë¬¸ ê²€ì¦ |

---

## ì£¼ì˜ì‚¬í•­

âš ï¸ **ë¹„ìš© ê´€ë ¨**
- AWS ë¦¬ì†ŒìŠ¤ ìƒì„± ì‹œ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤
- íŠ¹íˆ RDS, ElastiCache, NAT GatewayëŠ” ì‹œê°„ë‹¹ ê³¼ê¸ˆë©ë‹ˆë‹¤
- ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ëŠ” `terraform destroy`ë¡œ ì‚­ì œí•˜ì„¸ìš”

âš ï¸ **ë³´ì•ˆ ê´€ë ¨**
- `*.tfvars` íŒŒì¼ì—ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš” (ì´ë¯¸ .gitignoreì— ì¶”ê°€ë¨)
- AWS Access KeyëŠ” ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”©í•˜ì§€ ë§ˆì„¸ìš”
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ìµœì†Œ ê¶Œí•œ ì›ì¹™ì„ ë”°ë¥´ì„¸ìš”

âš ï¸ **ìš´ì˜ ê´€ë ¨**
- í”„ë¡œë•ì…˜ í™˜ê²½ ë³€ê²½ ì‹œ ë°˜ë“œì‹œ `terraform plan`ìœ¼ë¡œ ê²€í†  í›„ ì ìš©í•˜ì„¸ìš”
- State íŒŒì¼ì€ S3 ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ€ì›ê³¼ ê³µìœ í•˜ì„¸ìš”
- ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ì€ íŒ€ì›ë“¤ê³¼ ì‚¬ì „ ê³µìœ í•˜ì„¸ìš”

---

## ë‹¤ìŒ ë‹¨ê³„

1. âœ… ìš”êµ¬ì‚¬í•­ ë¬¸ì„œ ì‘ì„±
2. â³ Network ëª¨ë“ˆ êµ¬í˜„
3. â³ Security Groups ëª¨ë“ˆ êµ¬í˜„
4. â³ RDS ëª¨ë“ˆ êµ¬í˜„
5. â³ ElastiCache ëª¨ë“ˆ êµ¬í˜„
6. â³ EC2 ëª¨ë“ˆ êµ¬í˜„
7. â³ ALB ëª¨ë“ˆ êµ¬í˜„
8. â³ CodePipeline ëª¨ë“ˆ êµ¬í˜„

---

## ì°¸ê³  ìë£Œ

- [Terraform ê³µì‹ ë¬¸ì„œ](https://www.terraform.io/docs)
- [AWS Provider ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [Terraform Best Practices](https://www.terraform-best-practices.com/)
